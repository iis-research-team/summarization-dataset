Общепризнанными и широко распространенными подходами семантического моделирования,
по мнению большинства исследователей [1], являются ER-модель («Entity – Relationship») Чена [2],
UML («Unified Modeling Language») [3] и получившая в последнее время развитие OR-модель («Object – Role») Халпина [4]. Ранние модели этого класса (ER, UML) были предназначены только для
проектирования структур хранимых данных, не предполагающих дублирование информации о предметной области (ПрО). Поэтому в схемах данных этих моделей каждому явлению ПрО проектировщик должен был подобрать единственную форму – сущность, связь или значение. Более поздние семантические модели (ORM в частности) стали включать возможность проектирования так называемых получаемых (derived) структур, чьи данные непосредственно не хранятся на диске, а вычисляются с помощью тех или иных правил, определенных в схеме. С помощью этих возможностей можно
наряду с основной хранимой формой явления определить дополнительные получаемые формы.
Идея хранимых и получаемых структур данных получила новое развитие в ERM-модели («Entity – Relationship – Mapping» или модель «Сущность – Связь – Отображение»). В результате выделения базовых и производных понятий этой модели [5] были выявлены проблема синонимичных элементов ERM-схем [6] и их роль в методике проектирования схем БД [7]. На первых этапах методики – анализа ПрО и высокоуровневого проектирования, производные понятия облегчают процесс
первичной формализации восприятия ПрО человеком. По мере углубления и усложнения своих представлений проектировщик переходит на язык базовых понятий, обеспечивающих всю полноту выразительных возможностей ERM-модели.
Практическая реализация инструментов ERM-моделирования требует детальной проработки
методики совместного представления синонимичных базовых и производных элементов ERM-схем, в
том числе в графической нотации.
1. Методика использования графических средств проектирования ERM-схем
Несмотря на то что основные базовые и производные структурные понятия изоморфны в плане
выразительности семантики ПрО, проще в использовании последние. Действительно, такие понятия, как «множество сущностей», «множество связей» и «атрибут», давно используются и стали привычными в профессиональной среде разработчиков БД. Естественно, что методика проектирования
ERM-схем данных не могла обойти этот факт стороной и предполагает преимущественное использование именно производных понятий на первых этапах процесса проектирования. К тому же, благодаря использованию понятий ER-модели Чена [2], удается сформировать компактное, но в то же время
цельное высокоуровневое представление информации о ПрО.
Если какие-то информационные элементы и законы их взаимодействия не нашли отражения на
языке ER-модели, следует перейти на язык базовых понятий (классов и отображений) и строить дополнительные углубленные представления для отдельных элементов первоначальной схемы. Построение ERM-схемы только с использованием базовых понятий не является в предлагаемой методике
самоцелью (хотя такое возможно), к этому языку следует прибегать лишь в случае необходимости. К
тому же, как будет показано далее, методика предполагает автоматическую редукцию ERM-схемы до
уровня базовых понятий.
Итак, методика проектирования ERM-схем с использованием расширенной графической нотации включает следующие этапы:
1) проектирование каркасной ERM-диаграммы всей ПрО;
2) уточнение каркасной ERM-диаграммы;
3) автоматическую генерацию реляционных отображений и построение диаграмм реляционных
отображений некоторых множеств связей. Уточнение ограничений целостности на реляционные
отображения;
4) автоматическую генерацию отображений, сопутствующих атрибутным отображениям множеств связей, и уточнение диаграмм для этих множеств связей;
5) явное введение ролей на диаграммах множеств связей и определение дополнительных ограничений целостности;
6) определение получаемых отображений с помощью операций над отображениями. Задание их
ограничений целостности;
7) построение диаграмм взаимоотношений между классами и между отображениями. Возможно, потребуется использование в них операций над классами и отображениями;
8) уточнение состава и ограничений целостности специализаций и категоризаций. Определение
отображений, которые являются основаниями деления специализаций.
Процедура проектирования может быть прекращена после любого из указанных шагов в случае
полного представления в ERM-схеме всей требуемой семантики ПрО.
Пояснять применение методики мы будем на примере ПрО планирования занятий в вузе. Для
упрощения рисунков рассмотрим лишь небольшую часть схемы и опустим почти все характеристики
объектов.
2. Проектирование каркасной ERM-диаграммы ПрО
Объекты, мыслимые в высказываниях о ПрО как предметы, представляют собой сущности, а
классы понятий таких объектов есть не что иное, как множества сущностей. Идеальные объекты, такие как числа, даты, строки символов, являются значениями. Они не обладают свойствами, характеристиками и не вступают в отношения с другими объектами, кроме того, что являются значениями
характеристик объектов. Их объединяют во множества значений по синтаксическим особенностям.
Объекты, подпадающие под конкретные понятия об n-ках предметов, представляют собой связи, а
классы объектов, составляющих объемы таких понятий, есть не что иное, как множества связей.
Каждый объект в связи играет определенную роль, характеризующую его функцию в этой связи.
Отображение, ставящее в соответствие объекту истинностное значение, называется отображением-свойством. Если в качестве области значений в отображении используется произвольное множество значений, такое отображение будем называть отображением-характеристикой. Отображения-свойства представляют собой частный случай отображений-характеристик. Отображенияхарактеристики являются не чем иным, как атрибутными отображениями, или просто атрибутами.
Рассмотрим фрагмент ERM-схемы, приведенный на рис. 1. Этот вариант диаграммы практически совпадает с ER-диаграммой Чена. Добавлена лишь специализация преподавателей в зависимости от наличия или отсутствия у них той или иной ученой степени.
На схеме представлен основной объект планирования академической деятельности – элемент
расписания занятий (ЭРЗ). По мнению проектировщика, он представляет собой тип связей, в каждой
из которых задействованы конкретные дисциплина, студенческая группа, преподаватель, вид занятий, аудитория, время и день недели. Действительно, именно эти элементы указаны в каждой клеточке расписания занятий.
3. Уточнение каркасной ERM-диаграммы
Для построения адекватной задачам ПрО ERM-схемы необходимо для каждого явления подобрать подходящую форму данных – значение, связь или сущность. Эта задача известна как проблема
триализма форм данных. Бывают случаи, когда эту задачу решить непросто.
Например, такой тип явлений, как БРАК между людьми, можно мыслить как атрибут, множество связей или множество сущностей. Проектируя схему БД, необходимо сделать выбор в пользу
одного из этих представлений. При этом можно использовать следующие соображения.
Если вам достаточно информации о том, состоит человек в браке или нет, можно рассмотреть
этот тип явлений как атрибут множества сущностей ЧЕЛОВЕК. Если же Вас интересует, с кем конкретно заключен брак, необходимо трактовать БРАК как множество связей между сущностями множества ЧЕЛОВЕК. Даже если Вы захотите описать это явление с помощью тех или иных характеристик, Вам не придется менять форму множества связей (в ERM-модели, как и в ER-модели Чена,
множества связей могут иметь характеристики). А вот если понадобится представлять связи браков с
другими явлениями, Вам не обойтись без множества сущностей БРАК (связи непосредственно не могут вступать в другие связи).
Мы перечислили варианты представления в порядке возрастания функциональности и информативности форм. Но это не означает, что все явления нужно трактовать как сущности. Бинаризация
представлений (сведение структур данных к понятиям бинарной модели – множествам знаков и исключительно бинарным отношениям между ними), на первый взгляд, упрощает проектирование, но
она скрадывает важную для проектирования эффективной схемы БД семантику ПрО, невосполнимую
на последующих этапах. Особое внимание также следует уделить построению необходимой и достаточной системы
сущностей, составляющих одну связь каждого рассматриваемого множества связей. С одной стороны, в нее должны войти все объекты, определяющие смысл высказывания о взаимосвязи предметов, с
другой стороны, в ней не должно быть объектов, которые можно исключить из высказывания без потери информации.
Имеет смысл руководствоваться следующими соображениями. В момент создания связи должны быть определены все сущности, в ней участвующие. Не должно быть связей, в которых хотя бы
одна сущность появляется позже, а значит, до поры до времени ссылка на нее в связи пуста. И в
дальнейшем, пока существует связь, указатели на все сущности в ней не изменяются. С удовлетворением этих требований в первоначальной схеме нашего примера, как видим, все в порядке.
Кроме того, следует отличать сущности, участвующие в связи, от значений характеристик связи.
Именно на это обратил бы свое внимание проектировщик при уточнении нашей каркасной ERMдиаграммы. Действительно, если такие участники связей типа ЭРЗ, как дисциплина, студенческая
группа, преподаватель, вид занятий, аудитория не вызывают сомнений (они являются полноценными
сущностями, которые могут обладать характеристиками, вступать в другие связи), то время и день недели представляют собой не более чем значение, состоящее из количества часов и количества минут
(время), и одну из семи строк символов (день недели). Больше о них нам, пожалуй, вряд ли что захочется сказать.
Поэтому проектировщик приходит к мысли заново рассмотреть для этих явлений задачу выбора формы данных, а именно он решает считать их значениями. Это приводит к изменению структуры
и степени множества связей ЭРЗ и появлению у него двух атрибутов Время начала и День недели
(рис. 2). Хочется верить, что интеллектуальные инструменты ERM-моделирования окажут помощь
проектировщику в таком преобразовании. Обратите внимание на изменившиеся пометки на ребрах ролей. Сказывается влияние бывших
множеств сущностей ВРЕМЯ и ДЕНЬ НЕДЕЛИ на уникальную идентификацию сущностей типа
ДИСЦИПЛИНА, ПРЕПОДАВАТЕЛЬ и ВИД ЗАНЯТИЙ. На первый взгляд, может показаться, что
уточнение ERM-схемы привело к потере важных особенностей данных, однако это не так – изменилась лишь форма выражения этих законов, и позже Вы это увидите.
Следует пояснить функциональную определенность аудитории. Предположим, что в нашей
предметной области обучение ведется по специальным дисциплинам, требующим особого оборудования и программного обеспечения. В таком случае преподаватель определяет необходимую ему для
занятий конкретного вида по конкретной дисциплине инфраструктуру, и ее устанавливают в одной
специальной аудитории. 4. Автоматическая генерация реляционных отображений и построение диаграмм
реляционных отображений множеств связей. Уточнение ограничений
целостности на реляционные отображения
До этого момента наша ERM-схема включала в себя 8 множеств сущностей, 1 множество связей, 2 однозначных атрибута множества связей и 1 специализацию множеств сущностей. Все эти элементы указал непосредственно проектировщик. Чтобы помочь человеку в разработке часто непростой ERM-схемы, диалоговый инструмент должен брать на себя часть обязанностей по ее определению. На этом этапе редактор ERM-диаграмм пополнит схему реляционными отображениями и покажет их на диаграмме (рис. 3). Эти отображения и часть ограничений целостности, наложенных на
них, определяются заданными на предыдущих шагах множествами связей.
Отображения, определяемые множествами связей, которые в качестве областей определения и
значений имеют одиночные множества сущностей или их декартовы произведения, называются реляционными. Из всех 2n
–2 реляционных отображений, определяемых множеством связей степени n,
на схеме обычно показываются только 2n отображений, определяемых ролями и определяющих роли
(при n = 3 эти отображения исчерпывают все множество реляционных отображений). Как видим, в случае, когда и определяемое ролью, и определяющее ту же роль реляционные
отображения неограниченны, в кратком варианте диаграммы реляционных отображений между прямоугольником множества сущностей и ромбом множества связей может оставаться простое ребро
(как в нотации Чена).
Хотя ромб и подписан как проекция множества связей ЭРЗ на n – 1 роль, на самом деле он олицетворяет для каждого определяемого ролью и определяющего роль реляционного отображения декартово произведение n – 1 классов, на которых, помимо класса, стоящего на противоположном полюсе отображения, определено множество связей ЭРЗ.
Если есть потребность в представлении на диаграмме всех 2n
 – 2 реляционных отображений,
определяемых одним множеством связей степени n, это может быть сделано, как показано на рис. 4.
Мы намеренно рассматриваем множество связей третьей степени ОБЕСПЕЧЕНИЕ ДИСЦИПЛИН
ПРЕПОДАВАТЕЛЯМИ, поскольку для множества связей ЭРЗ потребовалось бы демонстрировать
30 реляционных отображений.
Каждый раз, когда опущен ромб, олицетворяющий множество связей, которое определяет роли
и реляционные отображения, он незримо присутствует и предполагает, в частности, инверсность взаимообратных отображений. К началу стрелки, изображающей отображение, подходят ребра от классов (в данном случае множеств сущностей), которые составляют область определения отображения
(ООО), а из конца стрелки выходят ребра к классам (множествам сущностей), которые составляют
область значений отображения (ОЗО). 5. Автоматическая генерация отображений, сопутствующих атрибутным отображениям
множеств связей, и уточнение диаграмм для этих множеств связей
Другим примером использования генератора отображений является случай, когда множество
связей имеет один или более атрибутов. В таком случае создаются отображения, в которых ООО и
ОЗО формируются из множеств сущностей, участвующих во множестве связей, и множеств значений, которые составляют ОЗО атрибутных отображений. Ясно, что такие отображения не являются
ни атрибутными, ни реляционными. Поэтому мы называем их отображениями, сопутствующими атрибутным отображениям множеств связей (рис. 5). На рис. 5 показаны лишь ограниченные отображения, и то не все. В центре расположена стрелка
отображения, для которого ООО составляют нижние классы, а ОЗО – верхние классы. Именно функциональность этого отображения определяет функциональность всех остальных отображений, представленных на этом рисунке. По большому счету, нет необходимости показывать их функциональность, интеллектуальный инструмент ERM-моделирования должен быть в состоянии оперировать подразумеваемыми ограничениями целостности без необходимости их явного задания. Более того, он обязан
определять любые противоречия, некорректности схемы и сообщать об этом проектировщику.
Кстати, пары крайних отображений – это те отображения, функциональность которых была явно указана на рис. 1 и была утеряна после преобразований на рис. 2 в силу недостаточной выразительности ER-модели.
6. Явное введение ролей на диаграммах множеств связей и определение
дополнительных ограничений целостности
Отсутствие явного указания ролей на диаграмме множества связей может привести к неопределенности и допустимо только в случае, когда каждое множество сущностей играет одну и только одну роль во множестве связей. Тем не менее даже в этом случае они бывают необходимы на диаграммах для представления ограничений целостности, поскольку параллелограммы ролей олицетворяют
реальные области определения ролей (в отличие от прямоугольников множеств сущностей, представляющих потенциальные области определения ролей). Так, на рис. 6 с помощью отношения включения между ролями показано ограничение, утверждающее, что в элементах расписания занятий могут
участвовать только преподаватели, которые запланированы как обеспечивающие проведение занятий
по дисциплинам (на самом деле все немного сложнее; см. рис. 8). 7. Определение получаемых отображений с помощью операций над отображениями.
Задание их ограничений целостности
Многие законы ПрО можно представить в виде тех или иных ограничений, накладываемых на
так называемые получаемые (англ. derived) [4] отображения. Их экземпляры, в отличие от утверждаемых (англ. asserted) [4] пользователем отображений, в БД не хранятся, а с помощью операций над
данными определяются из экземпляров утверждаемых отображений. После автоматического построения необходимых утверждаемых отображений (шаги 3 и 4 методики) проектировщик может определить на ERM-диаграмме последовательность операций над отображениями, в результате выполнения
которой образуется производное получаемое отображение, и определить его тип (рис. 7). Единственное ограниченное реляционное отображение, определяющее роль аудитории (см. рис. 2
и 3), не точно отражает закон предметной области. На самом деле функциональное определение аудитории неизбыточно обеспечивают сущности типов дисциплина, преподаватель и вид занятий. Это обстоятельство может быть показано на ERM-диаграмме с использованием операции проекции и констатации того факта, что ее результат представляет собой функциональное отображение (рис. 7).
8. Построение диаграмм взаимоотношений между классами и между отображениями
Отношение между классами уже было показано на рис. 6. Покажем ограничение целостности,
связанное с определением отношения между отображениями. На рис. 8 ориентированная стрелка
между получаемым и утверждаемым отображениями указывает на отношение следствия между ними.
Это ограничение представляет следующий закон ПрО: вести занятия определенного вида по дисциплине могут только преподаватели, обеспечивающие этот вид занятий по дисциплине. 9. Уточнение состава и ограничений целостности специализаций и категоризаций.
Определение отображений, которые являются основаниями деления специализаций
Заключительным аккордом проектирования ERM-схемы является определение ограничений
целостности специализаций, категоризаций и отображений, которые являются основаниями деления
специализаций (рис. 9). На рис. 9 показаны два варианта решений по поводу единственной специализации в нашей
ПрО. Их отличие связано с различной трактовкой атрибутного отображения Ученая степень множества сущностей ПРЕПОДАВАТЕЛЬ, являющегося основанием деления класса ПРЕПОДАВАТЕЛЬ на
преподавателей без степени, кандидатов и докторов наук. Если предположить, что этот атрибут однозначный, т.е. человек не может считаться одновременно и кандидатом, и доктором, то мы приходим к
варианту полной непересекающейся специализации (рис. 9, а). В противном случае более правильным является вариант полной пересекающейся специализации (рис. 9, б).
Заключение
Семантическая модель данных «Сущность – Связь – Отображение» сочетает в себе естественность ее понятий для человека и полноту представления свойств данных. Большая детальность описания ПрО в этой модели неизбежно должна приводить к повышенной сложности ее использования.
Хорошо продуманная методика ERM-моделирования и CASE-средства, автоматизирующие построение базовых элементов ERM-схемы, синонимичных явно указанным проектировщиком, частично
упрощают его задачу.
Человек фиксирует семантику ПрО в удобных и понятных ему формах. Перевод этих описаний
на низкоуровневый, но более выразительный язык базовых понятий ERM-модели осуществляется
автоматически. В результате этих преобразований ERM-схемы у проектировщика появляется возможность продолжить формализацию своих представлений о ПрО на новом, недоступном ранее базовом уровне. Таким образом, методика ERM-моделирования способствует точной и полной формализации представлений о предметной области. 