В современной российской судебной практике в качестве доказательств принимаются
аудио- и видеоматериалы. Ранее процессуальное законодательство было недостаточно проработано – решение о приобщении видеоматериалов к делу в административном, уголовном,
гражданском и арбитражном процессах принимал судья. Однако в апреле 2016 г. был подписан указ [1], согласно которому звуко- и видеозаписи признаются документами и выступают
как доказательства в административных делах, если они имеют значение для рассмотрения
и разрешения дела. Благодаря этому указу, рассматривая административные дела, судьи
обязаны принимать к рассмотрению видеозапись, и теперь вопрос уже о признании ее достоверности.
Ведение видеозаписи полезно не только как средство фиксирования событий в потенциально опасных ситуациях, но и как превентивная мера. Если возможный правонарушитель
осознает, что его действия записываются, то более вероятно, что он воздержится от правонарушения.
Видеозапись может использоваться не только для фиксации правонарушений. При соблюдении соответствующего законодательства человек вправе снимать различные эпизоды
своей жизни, чтобы в дальнейшем вернуться к ним, проанализировать произошедшие события. Ему даже необязательно пересматривать записи целиком, чтобы найти что-либо интересное – уже существуют многочисленные способы автоматизированного извлечения информации из видеоматериалов. Так, например, были предложены способы обнаружения
некоторых типов событий – оставление, перебрасывание предмета и пр. [2]
Доступным способом сделать видеозапись является использование мобильного телефона.
Как правило, когда случается что-то экстренное, у человека под рукой нет видеокамеры. Зато
есть мобильное устройство – еще в 2013 г. мобильными телефонами пользовалось 98 % российских граждан [3].
Однако при создании видеозаписи с помощью мобильного устройства существует две
проблемы:
1) на запуск видеосъемки может затрачиваться много времени;
2) в случае утраты телефона не обеспечивается сохранность данных.
Таким образом, актуальными задачами являются выбор способа быстрого запуска видеозаписи с мобильного устройства и создание средств, обеспечивающих сохранность видеозаписи даже при разрушении мобильного устройства.
В статье описано мобильное приложение, которое обеспечивает оперативность запуска
записи с помощью виджета на экране и сохранность видеозаписи за счет непрерывной передачи видеофрагментов длительностью 1 секунда в облачные сервисы.
Авторами статьи был выбран определенный набор используемых технологий. Для обеспечения сохранности видеозаписи было предложено отправлять запись на удаленные серверы непосредственно в процессе ее создания. Удаленные серверы должны удовлетворять двум
основным требованиям – они должны быть надежными и предоставлять минимум 5 Гб хранилища без взимания платы. Таким требованиям удовлетворяют многие облачные сервисы,
вследствие чего они и были выбраны как место, куда транслируются данные пользователя.
Одним из возможных решений передачи видеозаписи на удаленные серверы во время ее
создания является потоковое вещание (англ. streaming). К примеру, можно было бы использовать набор технологий WebRTC, который позволил бы работать с видеопотоками через
браузер [4]. Однако многие облачные сервисы не поддерживают потоковое вещание, поэтому
был выбран иной подход. Каждую секунду очередной созданный фрагмент видеозаписи сохраняется локально, после чего отправляется в облачный сервис. Таким образом, сохранность видеоданных достигается за счет отправки большого количества видеофрагментов малой длины, которые впоследствии могут быть собраны в единую запись.
Среди множества облачных сервисов для хранения данных выбор пал на Google Диск, поскольку он гарантирует сохранность данных и предоставляет 15 Гб для хранения данных
бесплатно.
Мобильной платформой, под которую разработано приложение, выбран Android. По статистике на первый квартал 2017 г., 85 % мирового рынка мобильных устройств занимают
Android-устройства, поэтому ориентация на данный сегмент представляется достаточной.
Главное требование, предъявленное к способам запуска трансляции, – запись должна начинаться как можно быстрее. В связи с этим сделан выбор в пользу использования виджета.
Пользователь может расположить виджет на любом экране мобильного устройства, в том
числе и на главном, и тогда ему не нужно тратить время на поиск приложения в общем списке и нажатие кнопки в запущенном приложении – достаточно один раз нажать на виджет.
В настоящее время существуют мобильные приложения под различные платформы, занимающиеся передачей видеоданных на удаленные серверы. Был произведен анализ известных
Android-приложений, наиболее приближенных к решению упомянутых проблем с получением и сохранностью видеоматериалов (рис. 1). Такие популярные сервисы, как YouTube, Periscope, Instagram, предоставляют возможность делать потоковую видеозапись так, что ее могут увидеть пользователи других устройств. Соответствующие приложения хорошо знакомы широкой публике и обладают высокой степенью надежности. Однако все они были созданы для иных целей, вследствие чего
обладают рядом особенностей, которые являются недостатками в контексте цели разработанного приложения. Это, во-первых, отсутствие локального сохранения при невозможности
получить доступ в Интернет и, во-вторых, достаточно долгий запуск: чтобы запустить трансляцию, пользователю как минимум нужно запустить приложение и нажать в нем соответствующую кнопку.
Этих недостатков лишено ОКО, которое позволяет начать запись при нажатии на виджет. Однако и у него есть свои недостатки.
1. Отсылка фрагментов видеозаписи происходит каждые 5 или 10 секунд, что является
достаточно большим промежутком времени. Если устройство будет повреждено на 4-й или
9-й секунде, есть шанс потерять важные данные.
2. Отсутствие возможности получить единую запись из снятых фрагментов. Приложение
способно проиграть фрагменты один за другим, однако функция создания цельной видеозаписи отсутствует.
Главная функция разработанного приложения – создание видеозаписи и передача ее в облачный сервис. При этом запись передается по фрагментам: каждую секунду очередной
фрагмент видеозаписи сохраняется локально и отправляется в облачный сервис (рис. 2). После запуска приложения и авторизации пользователю доступен предварительный просмотр камеры и кнопка «Начать запись». При нажатии на кнопку начинается видеозапись
и ее передача по фрагментам в отдельном, не главном, потоке. Этот процесс продолжается
до тех пор, пока пользователь не нажмет на кнопку «Стоп».
Если пользователь уже авторизован, для начала записи ему достаточно нажать на виджет,
не заходя предварительно в приложение.
Если в процессе ведения записи пользователь временно потерял доступ в Интернет, после
повторного подключения записанные во время автономного режима работы фрагменты
все равно будут отправлены в Google Диск, что обеспечивается сервисами Google. Так же,
к примеру, функционирует и Google Analytics [5].
Разработанная архитектура приложения включает в себя 6 модулей (рис. 3).
1. Модуль авторизации выполняет необходимую для работы с Google Диском авторизацию пользователя через аккаунт Google.
2. Модуль ведения видеозаписи занимается получением видеоданных с камеры, разбиением их на фрагменты и локальным сохранением этих фрагментов.
3. Модуль трансляции фрагментов отправляет во время ведения записи уже сохраненные
локально фрагменты в облачный сервис.
4. Модуль управления записями служит для предоставления пользователю возможности
просматривать имеющиеся видеозаписи, сведения о дате их создания, их местоположение
(локально и / или в облачном сервисе) и состояние (фрагментирована запись или едина).
Также дает возможность удалить запись как локально, так и с облачного сервиса.
5. Модуль сборки записи собирает фрагменты в единую видеозапись.
6. Модуль синхронизации записей с облачным сервисом позволяет загрузить недостающие фрагменты с облачного сервиса на мобильное устройство. Рассмотрим особенности реализации приложения. Минимальная поддерживаемая версия
операционной системы – Android 5.0 Lollipop, что позволяет охватить 79,8 % от всех
Android-устройств (по состоянию на декабрь 2017 г.) .4 Дизайн учитывает Material Design,
разработанный компанией Google (рис. 4). Создаваемая видеозапись имеет формат MP4, ее
кадровая частота (FPS) равна 30 кадров в секунду. Время между ключевыми кадрами составляет одну секунду. Приложение реализовано на языке Java. Архитектура разработана на базе шаблона MVP
(Model-View-Presenter), что делает ее гибкой и позволяет добавить новые способы запуска
видеотрансляции без модификации существующего кода.
Для работы с камерой используется android.hardware.camera2 API, пришедший на смену
Camera API с уровня Android API 21.
Для получения с камеры видеопотока, отображения его на дисплее устройства и одновременно с этим разбиения видеопотока на фрагменты за основу была взята библиотека
AudioVideoRecordingSample, переработанная в собственный переиспользуемый компонент.
Для рендеринга видеопотока применяется OpenGL ES. Чтобы создавать видеофайлы-фрагменты, была предпринята попытка использовать
MediaRecorder API, однако выявилась проблема. Управление записью в классе MediaRecorder
основано на простом конечном автомате. После окончания записи одного фрагмента вновь
перейти в состояние записи можно лишь снова проведя инициализацию, конфигурацию источника данных и подготовку (каждому из этих действий соответствует отдельное состояние). Все эти операции занимают время порядка 700 миллисекунд [6], а поскольку, согласно
требованиям, перезапуск должен осуществляться каждую секунду, многие моменты оказываются незафиксированными. Поэтому для видеозаписи используются более низкоуровневые
классы MediaCodec и MediaMuxer. MediaCodec используется для сжатия видеопотока, в то
время как MediaMuxer записывает видеопоток в MP4-файл.
Для того чтобы видеофрагменты отправлялись в облачные сервисы в отдельных потоках,
применяется RxJava 2, в частности планировщики Schedulers. Работа с Google Диском осуществляется через Google Drive Android API. С целью создать на основе снятых видеофрагментов цельную видеозапись применяется написанная на языке программирования Java библиотека mp4parser 7
, созданная специально для работы с MP4-файлами.
Резюмируем: представленное Android-приложение является удобным способом сбора видеоинформации, которая может не только использоваться для личных нужд, но и выступать
в качестве доказательства в судебных разбирательствах. В целях обеспечения сохранности
данных в процессе создания видеозаписи ведется ежесекундное локальное сохранение полученного фрагмента и его передача в облачный сервис Google Диск, где любой зарегистрированный пользователь может получить пространство достаточного размера для хранения данных бесплатно. Для того чтобы не пропустить важные моменты, приложение снабжено
способом оперативного запуска видеотрансляции с помощью виджета, который пользователь
может разместить на экране там, где ему удобно.
Приложение выгодно выделяется среди конкурентов небольшой продолжительностью
создаваемого и отправляемого видеофрагмента, что при внезапной поломке устройства
в процессе видеосъемки позволяет сохранить больший объем данных. Кроме того, поскольку
работать с множеством фрагментов вместо единой записи по меньшей мере неудобно, предусмотрена возможность произвести сборку фрагментов в один MP4-файл. При этом, если
на мобильном устройстве не хватает каких-либо фрагментов, имеющихся в облачном сервисе, они загружаются на устройство перед сборкой.
В настоящий момент ввиду малой продолжительности самостоятельных фрагментов собираемая запись имеет достаточно большой размер. В дальнейшем планируется работа
по его уменьшению. Помимо этого, приложение передает данные только в облачный сервис
Google Диск. При поддержке иных облачных сервисов (таких как Яндекс.Диск, Dropbox) была бы удобна функция автоматического переключения на другой облачный сервис при достижении лимита в каком-то хранилище.
В перспективе возможно добавление запуска видеозаписи по голосовой команде, а также
введение системы оповещений в виде push-нотификаций при начале записи кругу доверенных лиц с предоставлением им доступа к создаваемой видеозаписи. Push-нотификации могут
показаться недостаточно привлекающим внимание способом сообщить о важном событии,
однако их использование в этом качестве активно применяется на практике [7].